<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>NTTCMIS</title>
    <link rel="icon" type="image/png" href="./icons/nttcmis.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    animation: {
                        'running-red-outline': 'running-red-outline 1.5s infinite',
                        'running-orange-outline': 'running-orange-outline 1.5s infinite',
                    },
                    keyframes: {
                        'running-red-outline': {
                            '0%, 100%': { boxShadow: '0 0 0 red' },
                            '50%': { boxShadow: '0 0 5px red' },
                        },
                        'running-orange-outline': {
                            '0%, 100%': { boxShadow: '0 0 0 rgb(255, 166, 0)' },
                            '50%': { boxShadow: '0 0 5px rgb(255, 153, 0)' },
                        }
                    },
                    backgroundImage: {
                        'gradient-radial': 'radial-gradient(var(--tw-gradient-stops))',
                        'gradient-conic': 'conic-gradient(from 180deg at 50% 50%, var(--tw-gradient-stops))',
                    }
                }
            }
        }
    </script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #000000 0%, #1a237e 50%, #000000 100%);
        }
        .gradient-button {
            background: linear-gradient(135deg, #1a237e 0%, #000000 100%);
        }
        .gradient-button:hover {
            background: linear-gradient(135deg, #000000 0%, #1a237e 100%);
        }
        .gradient-card {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
            backdrop-filter: blur(10px);
        }
    </style>
</head>
<body class="opacity-0 transition-opacity duration-3000 ease-in fade-in gradient-bg min-h-screen text-white">
<div class="w-full shadow-lg bg-black/30 backdrop-blur-sm border-b border-white/10">
    <div class="container mx-auto px-4 py-6">
        <div class="flex flex-col md:flex-row items-center justify-between gap-6">
            <div class="flex items-center gap-4">
                <img src="./icons/tlogo.png" alt="Left Logo" class="w-20 h-auto md:w-24 hover:scale-105 transition-transform duration-300">
                <div class="hidden md:block w-px h-16 bg-gradient-to-b from-transparent via-white/20 to-transparent"></div>
            </div>
            
            <h1 class="text-xl md:text-2xl lg:text-3xl font-bold text-center text-white bg-gradient-to-r from-blue-400 to-blue-600 bg-clip-text text-transparent">
                NATIONAL TVET TRAINER'S CERTIFICATE RECORDS
            </h1>
            
            <div class="flex items-center gap-4">
                <div class="hidden md:block w-px h-16 bg-gradient-to-b from-transparent via-white/20 to-transparent"></div>
                <img src="./icons/blogo.png" alt="Right Logo" class="w-20 h-auto md:w-24 hover:scale-105 transition-transform duration-300">
            </div>
        </div>
        
        <div class="flex flex-col sm:flex-row flex-wrap justify-center gap-3 mt-8">
            <button onclick="window.location.href='../index.html'" class="px-6 py-2.5 gradient-button text-white rounded-lg transition-all duration-300 min-w-[140px] hover:shadow-lg hover:shadow-blue-500/50 flex items-center justify-center gap-2">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </button>
            <button onclick="window.location.href='convert.html'" class="px-6 py-2.5 gradient-button text-white rounded-lg transition-all duration-300 min-w-[140px] hover:shadow-lg hover:shadow-blue-500/50 flex items-center justify-center gap-2">
                <i class="fas fa-file-excel"></i>
                <span>Convert Excel</span>
            </button>
            <button onclick="window.location.href='recently-expired.html'" class="px-6 py-2.5 bg-transparent text-red-400 rounded-lg border-2 border-red-400 hover:bg-red-400/10 transition-all duration-300 min-w-[140px] animate-running-red-outline flex items-center justify-center gap-2">
                <i class="fas fa-exclamation-circle"></i>
                <span>Recently Expired</span>
            </button>
            <button onclick="window.location.href='dfr.html'" class="px-6 py-2.5 bg-transparent text-orange-400 rounded-lg border-2 border-orange-400 hover:bg-orange-400/10 transition-all duration-300 min-w-[140px] animate-running-orange-outline flex items-center justify-center gap-2">
                <i class="fas fa-clock"></i>
                <span>Due For Renewal</span>
            </button>
            <button onclick="window.location.href='statistics.html'" class="px-6 py-2.5 gradient-button text-white rounded-lg transition-all duration-300 min-w-[140px] hover:shadow-lg hover:shadow-blue-500/50 flex items-center justify-center gap-2">
                <i class="fas fa-chart-bar"></i>
                <span>Statistics</span>
            </button>
            <button onclick="exportData()" class="px-6 py-2.5 gradient-button text-white rounded-lg transition-all duration-300 min-w-[140px] hover:shadow-lg hover:shadow-blue-500/50 flex items-center justify-center gap-2">
                <i class="fas fa-download"></i>
                <span>Export Data</span>
            </button>
        </div>
    </div>
</div>

<div class="container mx-auto px-4 py-8">
    <div id="entryCount" class="text-center text-lg font-semibold text-blue-200 mb-2"></div>
    <div class="text-center text-lg text-blue-100 mb-4">
        Current NTTC Holders As of: <span id="currentDate"></span>
    </div>

    <div class="max-w-2xl mx-auto mb-8">
        <div class="relative flex items-center bg-white/10 rounded-full shadow-lg p-2 backdrop-blur-sm">
            <input type="text" id="searchInput" placeholder="Search records..." 
                class="w-full px-4 py-2 bg-transparent border-none focus:outline-none focus:ring-0 text-white placeholder-blue-200"
                oninput="searchTable()">
            <button id="searchButton" onclick="searchTable()" 
                class="px-4 py-2 gradient-button text-white rounded-full hover:shadow-lg hover:shadow-blue-500/50 transition-all duration-300">
                <i class="fas fa-search"></i>
            </button>
        </div>
        <div id="loadingMessage" class="hidden text-center text-blue-200 mt-2">Loading data...</div>
    </div>

    <div class="overflow-x-auto rounded-lg shadow-xl">
        <table class="min-w-full bg-white/5 backdrop-blur-sm border border-white/10 hidden md:table">
            <thead class="bg-black/30">
                <tr>
                    <th class="px-4 py-3 text-left text-xs font-medium text-blue-200 uppercase tracking-wider w-[15%]">Province</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-blue-200 uppercase tracking-wider w-[15%]">Last Name</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-blue-200 uppercase tracking-wider w-[15%]">First Name</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-blue-200 uppercase tracking-wider w-[15%]">Middle Name</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-blue-200 uppercase tracking-wider w-[10%]">Extension</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-blue-200 uppercase tracking-wider w-[15%]">Qualification</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-blue-200 uppercase tracking-wider w-[10%]">Certificate Number</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-blue-200 uppercase tracking-wider w-[10%]">Control Number</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-blue-200 uppercase tracking-wider w-[10%]">Date Issuance</th>
                    <th class="px-4 py-3 text-left text-xs font-medium text-blue-200 uppercase tracking-wider w-[10%]">Validity</th>
                </tr>
            </thead>
            <tbody id="data-table-body" class="divide-y divide-white/10">
                <!-- Data will be dynamically loaded here -->
            </tbody>
        </table>

        <!-- Mobile Card View -->
        <div id="mobile-card-view" class="md:hidden space-y-4 p-4">
            <!-- Cards will be dynamically loaded here -->
        </div>
    </div>

    <div class="flex justify-center mt-8">
        <div id="pagination" class="flex gap-2"></div>
    </div>
</div>

<footer class="bg-black/50 backdrop-blur-sm py-6 mt-8 border-t border-white/10">
    <div class="container mx-auto px-4">
        <div class="flex flex-col md:flex-row justify-between items-center">
            <p class="text-center md:text-left mb-4 md:mb-0 text-blue-200">&copy; 2024 Certificate Records Management System</p>
            <div class="flex gap-6">
                <a href="./index.html" class="text-blue-200 hover:text-white transition-colors"><i class="fas fa-home"></i> Home</a>
                <a href="#" class="text-blue-200 hover:text-white transition-colors"><i class="fas fa-info-circle"></i> About</a>
                <a href="#" class="text-blue-200 hover:text-white transition-colors"><i class="fas fa-envelope"></i> Contact</a>
            </div>
        </div>
    </div>
</footer>

<script>
    const entriesPerPage = 200;
    let currentPage = 1;
    let filteredData = [];
    let originalData = [];
    let debounceTimeout;

    async function loadData() {
        try {
            const response = await fetch('data.json');
            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }
            const data = await response.json();
            originalData = data;
            filteredData = originalData;
            renderTable();
        } catch (error) {
            console.error("Error loading data:", error);
        }
    }

    function renderTable() {
        const startIndex = (currentPage - 1) * entriesPerPage;
        const paginatedData = filteredData.slice(startIndex, startIndex + entriesPerPage);
        const tableBody = document.getElementById("data-table-body");
        const mobileView = document.getElementById("mobile-card-view");
        
        tableBody.style.opacity = 0;
        mobileView.style.opacity = 0;

        setTimeout(() => {
            // Desktop Table View
            tableBody.innerHTML = paginatedData.map(row => {
                const validityDate = new Date(row.AD);
                const today = new Date();
                const threeMonthsFromNow = new Date();
                threeMonthsFromNow.setMonth(today.getMonth() + 3);
                
                let validityColor = 'text-green-400';
                if (validityDate < today) {
                    validityColor = 'text-red-400';
                } else if (validityDate <= threeMonthsFromNow) {
                    validityColor = 'text-orange-400';
                }

                return `
                    <tr class="hover:bg-white/5 transition-colors">
                        <td class="px-4 py-4 break-words text-white">${row.B || ''}</td>
                        <td class="px-4 py-4 break-words"><a href="view_record.html?id=${encodeURIComponent(row.id)}" class="text-blue-300 hover:text-white hover:underline">${row.C || ''}</a></td>
                        <td class="px-4 py-4 break-words"><a href="view_record.html?id=${encodeURIComponent(row.id)}" class="text-blue-300 hover:text-white hover:underline">${row.D || ''}</a></td>
                        <td class="px-4 py-4 break-words"><a href="view_record.html?id=${encodeURIComponent(row.id)}" class="text-blue-300 hover:text-white hover:underline">${row.E || ''}</a></td>
                        <td class="px-4 py-4 break-words"><a href="view_record.html?id=${encodeURIComponent(row.id)}" class="text-blue-300 hover:text-white hover:underline">${row.F || ''}</a></td>
                        <td class="px-4 py-4 break-words text-white">${row.R || ''}</td>
                        <td class="px-4 py-4 break-words text-white">${row.AB || ''}</td>
                        <td class="px-4 py-4 break-words text-white">${row.AE || ''}</td>
                        <td class="px-4 py-4 break-words text-white">${formatDate(row.AC)}</td>
                        <td class="px-4 py-4 break-words ${validityColor}">${formatDate(row.AD)}</td>
                    </tr>
                `;
            }).join("");

            // Mobile Card View
            mobileView.innerHTML = paginatedData.map(row => {
                const validityDate = new Date(row.AD);
                const today = new Date();
                const threeMonthsFromNow = new Date();
                threeMonthsFromNow.setMonth(today.getMonth() + 3);
                
                let validityColor = 'text-green-400';
                if (validityDate < today) {
                    validityColor = 'text-red-400';
                } else if (validityDate <= threeMonthsFromNow) {
                    validityColor = 'text-orange-400';
                }

                return `
                    <div class="bg-white/5 backdrop-blur-sm rounded-lg p-4 border border-white/10 hover:bg-white/10 transition-colors">
                        <a href="view_record.html?id=${encodeURIComponent(row.id)}" class="block">
                            <div class="space-y-2">
                                <div class="flex flex-col">
                                    <span class="text-xs text-blue-200 uppercase">Name</span>
                                    <span class="text-white font-medium">${row.C || ''}, ${row.D || ''} ${row.E || ''} ${row.F || ''}</span>
                                </div>
                                <div class="flex flex-col">
                                    <span class="text-xs text-blue-200 uppercase">Qualification</span>
                                    <span class="text-white">${row.R || ''}</span>
                                </div>
                                <div class="flex flex-col">
                                    <span class="text-xs text-blue-200 uppercase">Certificate Number</span>
                                    <span class="text-white">${row.AB || ''}</span>
                                </div>
                                <div class="flex flex-col">
                                    <span class="text-xs text-blue-200 uppercase">Control Number</span>
                                    <span class="text-white">${row.AE || ''}</span>
                                </div>
                                <div class="flex flex-col">
                                    <span class="text-xs text-blue-200 uppercase">Date Issuance</span>
                                    <span class="text-white">${formatDate(row.AC)}</span>
                                </div>
                                <div class="flex flex-col">
                                    <span class="text-xs text-blue-200 uppercase">Validity</span>
                                    <span class="${validityColor}">${formatDate(row.AD)}</span>
                                </div>
                            </div>
                        </a>
                    </div>
                `;
            }).join("");

            tableBody.style.opacity = 1;
            mobileView.style.opacity = 1;
        }, 100);
        
        renderPagination();
        document.getElementById("entryCount").textContent = `Total Entries: ${filteredData.length}`;
    }

    function renderPagination() {
        const totalPages = Math.ceil(filteredData.length / entriesPerPage);
        const pagination = document.getElementById("pagination");
        let paginationHTML = '';

        // Previous button
        paginationHTML += `
            <button onclick="setPage(${currentPage - 1})" 
                class="px-4 py-2 rounded-lg ${currentPage === 1 ? 'bg-white/10 text-white/50 cursor-not-allowed' : 'gradient-button text-white hover:shadow-lg hover:shadow-blue-500/50'} transition-all duration-300">
                Previous
            </button>`;

        // Function to determine which page numbers to show
        const getVisiblePages = () => {
            const pages = [];
            const isMobile = window.innerWidth < 768;

            if (isMobile) {
                // Mobile view: Show 1, 2, ..., last
                pages.push(1);
                if (totalPages >= 2) {
                    pages.push(2);
                }
                if (totalPages > 2) {
                    pages.push('...');
                }
                if (totalPages > 2) {
                    pages.push(totalPages);
                }
            } else {
                // Desktop view: Show all pages
                for (let i = 1; i <= totalPages; i++) {
                    pages.push(i);
                }
            }
            
            return pages;
        };

        // Generate page buttons
        const visiblePages = getVisiblePages();
        visiblePages.forEach(page => {
            if (page === '...') {
                paginationHTML += `
                    <span class="px-4 py-2 text-white/50">...</span>`;
            } else {
                paginationHTML += `
                    <button onclick="setPage(${page})" 
                        class="px-4 py-2 rounded-lg ${page === currentPage ? 'gradient-button text-white shadow-lg shadow-blue-500/50' : 'bg-white/10 text-white hover:bg-white/20'} transition-all duration-300">
                        ${page}
                    </button>`;
            }
        });

        // Next button
        paginationHTML += `
            <button onclick="setPage(${currentPage + 1})" 
                class="px-4 py-2 rounded-lg ${currentPage === totalPages ? 'bg-white/10 text-white/50 cursor-not-allowed' : 'gradient-button text-white hover:shadow-lg hover:shadow-blue-500/50'} transition-all duration-300">
                Next
            </button>`;

        pagination.innerHTML = paginationHTML;
    }

    // Add window resize handler to update pagination
    window.addEventListener('resize', () => {
        renderPagination();
    });

    function setPage(page) {
        currentPage = page;
        renderTable();
    }

    function searchTable() {
        clearTimeout(debounceTimeout);
        debounceTimeout = setTimeout(() => {
            const searchTerm = document.getElementById("searchInput").value.toLowerCase().trim();
            
            if (searchTerm === '') {
                filteredData = originalData;
            } else {
                filteredData = originalData.filter(row => {
                    return (
                        (row.B && row.B.toString().toLowerCase().includes(searchTerm)) ||
                        (row.C && row.C.toString().toLowerCase().includes(searchTerm)) ||
                        (row.D && row.D.toString().toLowerCase().includes(searchTerm)) ||
                        (row.E && row.E.toString().toLowerCase().includes(searchTerm)) ||
                        (row.F && row.F.toString().toLowerCase().includes(searchTerm)) ||
                        (row.R && row.R.toString().toLowerCase().includes(searchTerm)) ||
                        (row.AB && row.AB.toString().toLowerCase().includes(searchTerm)) ||
                        (row.AE && row.AE.toString().toLowerCase().includes(searchTerm)) ||
                        (row.AC && formatDate(row.AC).toLowerCase().includes(searchTerm)) ||
                        (row.AD && formatDate(row.AD).toLowerCase().includes(searchTerm))
                    );
                });
            }
            
            currentPage = 1;
            renderTable();
        }, 300);
    }

    loadData();

    document.getElementById('currentDate').textContent = new Date().toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
    });

    function formatDate(dateString) {
        const options = { year: 'numeric', month: 'long', day: 'numeric' };
        return new Date(dateString).toLocaleDateString('en-US', options);
    }

    window.onload = () => {
        document.body.classList.add('opacity-100');
    };

    function exportData() {
        fetch('data.json')
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => {
                if (!Array.isArray(data)) {
                    throw new Error("Invalid data format: Expected an array.");
                }

                const headers = [
                    "A", "B", "C", "D", "E", "F", "G", "H", "I", "J", "K", "L", "M", "N", "O",
                    "P", "Q", "R", "S", "T", "U", "V", "W", "X", "Y", "Z", "AA", "AB", "AC", "AD",
                    "AE", "AF", "AG", "AH", "AI"
                ];

                const rows = data.map(entry => [
                    entry.A, entry.B, entry.C, entry.D, entry.E, entry.F, entry.G, entry.H, entry.I,
                    entry.J, entry.K, entry.L, entry.M, entry.N, entry.O, entry.P, entry.Q, entry.R,
                    entry.S, entry.T, entry.U, entry.V, entry.W, entry.X, entry.Y, entry.Z, entry.AA,
                    entry.AB, entry.AC, entry.AD, entry.AE, entry.AF, entry.AG, entry.AH, entry.AI
                ]);

                const csvContent = [
                    headers.join(","),
                    ...rows.map(row => row.join(","))
                ].join("\n");

                const blob = new Blob([csvContent], { type: "text/csv;charset=utf-8;" });
                const url = URL.createObjectURL(blob);
                const link = document.createElement("a");
                link.setAttribute("href", url);
                link.setAttribute("download", "exported_data.csv");
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            })
            .catch(error => console.error("Error exporting data:", error));
    }
</script>
</body>
</html>
